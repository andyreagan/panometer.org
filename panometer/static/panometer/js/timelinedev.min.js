(function(){alert("You've somehow arrived at the development version. Navigate back to hedonometer.org, or beware of strange behavior and you can help us by reporting bugs to @hedonometer. Thanks for visiting :)");var c=location.href;c=c.replace("wordshift","index");history.pushState("something","something",c);String.prototype.width=function(aK){var aL=aK||"12px arial",aM=$("<div>"+this+"</div>").css({position:"absolute","float":"left","white-space":"nowrap",visibility:"hidden",font:aL}).appendTo($("body")),x=aM.width();aM.remove();return x};function aD(aN,x){var aM=aN.split(" ");var aO=[aM[0]];var aL=1;var aK=0;while(aL<aM.length){if((aO[aK]+aM[aL]).width()<x){aO[aK]+=" "+aM[aL]}else{aK++;aO.push(aM[aL])}aL++}return aO}var u=550,ap=["nigga","nigger","niggaz","niggas","thirsty"],av={},o=false,A=d3.time.format("%b %Y"),U=new Date(),O=new Date(2008,8,10),S=d3.time.format("%Y-%m-%d"),H=d3.time.format("%Y-%m-%dT00:00:00"),D=d3.time.format("%B %e, %Y"),d=d3.time.format("%A, %B %e, %Y"),aj=d3.urllib.encoder().varname("from");fromdecoder=d3.urllib.decoder().varname("from").varresult(S(d3.time.month.offset(U,-18))),toencoder=d3.urllib.encoder().varname("to"),todecoder=d3.urllib.decoder().varname("to").varresult(S(U)),dateencoder=d3.urllib.encoder().varname("date"),datedecoder=d3.urllib.decoder().varname("date"),shiftselencoder=d3.urllib.encoder().varname("wordtypes"),shiftseldecoder=d3.urllib.decoder().varname("wordtypes").varresult("none"),weekDaysShort=["sun","mon","tue","wed","thu","fri","sat"],weekDays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],popupExitDur=500,popupEnterDur=400,intStr=["zero","one","two","three"],aB=0,m=3.25,legendDict={mon:"on",tue:"on",wed:"on",thu:"on",fri:"on",sat:"on",sun:"on",hilite:"on",togall:"on",toggle:function(x,aK){this[x]=this[x]==="on"?"off":"on";G(aK)}};timeseries={};function W(x){return weekDays[x.date.getDay()]}function M(){var x=d3.select(this);popdate=S.parse(x.attr("shortdate"));r(popdate)}function a(x){if(legendDict.togall=="on"){d3.selectAll(".Monday, .Tuesday, .Wednesday, .Thursday, .Friday, .Saturday, .Sunday, .Togall").transition().duration(250).attr("r",x)}if(legendDict.togall=="off"){d3.selectAll(".Monday, .Tuesday, .Wednesday, .Thursday, .Friday, .Saturday, .Sunday, .Togall").transition().duration(250).attr("r",aB)}}function G(aK){for(var x=0;x<weekDays.length;x=x+1){if(legendDict[weekDaysShort[x]]=="on"){d3.selectAll("."+weekDays[x]).transition().duration(250).attr("r",aK)}else{d3.selectAll("."+weekDays[x]).transition().duration(250).attr("r",aB)}}if(legendDict.hilite=="on"){d3.selectAll(".Hilite").transition().duration(250).attr("visibility","visible")}else{d3.selectAll(".Hilite").transition().duration(250).attr("visibility","hidden")}}function aq(){var x=d3.select(this);x.attr("style","display: none;")}function aJ(){var x=d3.select("#minibox");x.attr("style","display: hidden;")}function al(x){newwindow=window.open(x,"name","height=820,width=780,scrollbars=no,resizeable=0");if(window.focus){newwindow.focus()}return false}function Q(){var aK=d3.select(this);var x=(F.domain()[1].getTime()-F.domain()[0].getTime());aK.transition().duration(250).attr("r",ac(x)).style("stroke-width",0.7);clearTimeout(hovertimer)}function ao(){var x=d3.select(this);popdate=S.parse(x.attr("shortdate"));hovertimer=setTimeout(function(){e(parseFloat(x.attr("cx")),parseFloat(x.attr("cy")),popdate,false)},popupEnterDur)}function aC(x){return new Date(x.date)}var z={top:10,right:10,bottom:100,left:0},p={top:430,right:10,bottom:20,left:0},ae=document.documentElement.clientWidth*0.9,af=document.documentElement.clientHeight*0.5,Z=50;var aB=0;var m=2.75;var C=d3.scale.ordinal().range(d3.svg.symbolTypes),s=d3.scale.category10();var at={top:10,right:10,bottom:100,left:0},am=parseInt(d3.select("#bigbox").style("width")),q=am*0.5,ak=50;var A=d3.time.format("%b %Y");var l=d3.select("#wrap");function aw(x){d3.select("#timeseries").remove();d3.select(".infobox h4").remove();d3.selectAll("rect:not(#shortlist)").style("fill","lightgrey");d3.select("#rect"+x).style("fill","black");timeline(x)}var at={top:10,right:40,bottom:100,left:0},am=parseInt(d3.select("#bigbox").style("width"))-at.left-at.right,q=d3.max([300,parseInt(d3.select("#bigbox").style("width"))*0.5-at.bottom-at.top]),ak=50;var an=40;var V=d3.scale.linear().domain([0,U.getTime()-O.getTime()]).range([-100,99.5]);var F=d3.time.scale().range([0,am-7]);var t=d3.time.scale().range([0,am-7]).domain([O,U]);y=d3.scale.linear().range([q,0]);var f=d3.scale.linear().range([ak,0]);var ag=d3.svg.axis().scale(F).orient("bottom"),J=d3.svg.axis().scale(t).orient("bottom"),P=d3.svg.axis().scale(y).orient("left");yAxis2=d3.svg.axis().scale(y).orient("right").ticks(7);var aa=d3.svg.brush().x(t).extent([S.parse(fromdecoder().cached),S.parse(todecoder().cached)]).on("brush",aF).on("brushend",K);var k=d3.svg.line().x(function(x){return F(x.date)}).y(function(x){return y(x.value)});var w=d3.svg.line();var I=new Date(0,11,25);var n=d3.time.format("%m-%d");var az=0;var ay=0;var v=d3.svg.line().x(function(x){if((n(x.date)==n(I))){az=x.date;return F(x.date)}else{return F(az)}}).y(function(x){if((n(x.date)==n(I))){ay=x.value;return y(x.value)}else{return y(ay)}});var T=d3.svg.area().interpolate("linear").x(function(x){return t(x.date)}).y0(ak).y1(function(x){return f(x.value)});var ai=d3.select("#bigbox").append("svg").attr("id","timeseries").attr("width",am+at.left+at.right).attr("height",q+at.top+at.bottom);ai.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",am).attr("height",q);var aH=ai.append("g").attr("id","focus").attr("transform","translate("+at.left+","+at.top+")");var aG=ai.append("g").attr("id","focus2").attr("transform","translate("+at.left+","+at.top+")");var aE=ai.append("g").attr({"class":"legendgroup",transform:"translate("+(am-10-366)+","+1+")"});aE.append("rect").attr({"class":"legendbox",x:0,y:0,rx:3,ry:3,width:366,height:19,fill:"#F0F0F0","stroke-width":"0.5",stroke:"rgb(0,0,0)"});var ab=43;aE.selectAll("circle").data(weekDaysShort).enter().append("circle").on("mousedown",function(aL,x){var aK=(F.domain()[1].getTime()-F.domain()[0].getTime());legendDict.toggle(aL,ac(aK))}).attr("cx",function(aK,x){return 8+ab*x}).attr("cy",9).attr("r",m).attr("stroke","black").attr("stroke-width",0.7).attr("class",function(aK,x){return weekDays[x]});aE.selectAll("text").data(weekDaysShort).enter().append("text").attr("x",function(aK,x){return 15+ab*x}).attr("y",14).on("mousedown",function(aL,x){var aK=(F.domain()[1].getTime()-F.domain()[0].getTime());legendDict.toggle(aL,ac(aK))}).text(function(aK,x){return weekDays[x][0]+weekDays[x][1]+weekDays[x][2]});aE.selectAll("rect.legendclick").data(weekDaysShort).enter().append("rect").attr({"class":"legendrect",x:function(aK,x){return ab*x},y:0,width:ab-2,height:19,fill:"white",opacity:"0.0"}).on("mousedown",function(aL,x){var aK=(F.domain()[1].getTime()-F.domain()[0].getTime());legendDict.toggle(aL,ac(aK))});aE.selectAll("line").data([0,0,0,0,0,0,0]).enter().append("line").attr("stroke","grey").attr("stroke-width","2").attr("x1",function(aK,x){return 42+ab*x+aK}).attr("x2",function(aK,x){return 42+ab*x+aK}).attr("y1",0).attr("y2",19);aE.append("svg:circle").on("mousedown",function(){var x=(F.domain()[1].getTime()-F.domain()[0].getTime());legendDict.toggle("togall",ac(x))}).attr("cx",306).attr("cy",9).attr("r",m).attr("stroke","black").attr("stroke-width",0.7).attr("class","Togall");aE.append("svg:text").attr("x",306+6).attr("y",14).text("All on/off").attr("class","togall").attr("id","togall");aE.append("rect").attr({"class":"legendrect",x:301,y:0,width:66,height:20,fill:"white",opacity:"0.0"}).on("mousedown",function(){legendDict.toggle("togall");legendDict.mon=legendDict.togall;legendDict.tue=legendDict.togall;legendDict.wed=legendDict.togall;legendDict.thu=legendDict.togall;legendDict.fri=legendDict.togall;legendDict.sat=legendDict.togall;legendDict.sun=legendDict.togall;var x=(F.domain()[1].getTime()-F.domain()[0].getTime());G(ac(x))});var aI=[[O,new Date(2009,11,31)],[new Date(2010,0,1),new Date(2010,11,31)],[new Date(2011,0,1),new Date(2011,11,31)],[new Date(2012,0,1),new Date(2012,11,31)],[new Date(2013,0,1),new Date(2013,11,31)],[O,U],[d3.time.month.offset(U,-18),U]],ax=["\u2192 2009","2010","2011","2012","2013","Full","Last 18 mo"],Y=ax.map(function(x){return x.width()}),N=2,g=5,E=aI.length*g*2-g+N+d3.sum(Y);ai.append("text").attr({x:(am-10-E-53),y:44,fill:"grey"}).text("Jump to:");var au=ai.append("g").attr({"class":"yeargroup",transform:"translate("+(am-10-E)+","+30+")"});au.append("rect").attr({"class":"yearbox",x:0,y:0,rx:3,ry:3,width:E,height:19,fill:"#F0F0F0","stroke-width":"0.5",stroke:"rgb(0,0,0)"});au.selectAll("text").data(ax).enter().append("text").attr("x",function(aK,x){if(x==0){return N}else{return d3.sum(Y.slice(0,x))+N+x*g*2}}).attr("y",14).text(function(aK,x){return aK});au.selectAll("rect.yearclick").data(aI).enter().append("rect").attr({"class":"yearrect",x:function(aK,x){if(x===0){return 0}else{return d3.sum(Y.slice(0,x))+x*g+(x-1)*g+N}},y:0,width:function(aK,x){if(x===0){return Y[x]+N+g}else{return Y[x]+g*2}},height:19,fill:"white",opacity:"0.0"}).on("mousedown",function(aL,aK){aa.extent(aL);aF();K();ah.select(".x.brush").call(aa);var x=V(aL[1].getTime()-aL[0].getTime());d3.selectAll("text.bigdaytext").transition().duration(1000).attr("visibility",function(aN,aM){if(aN.importance>x){return"visible"}else{return"hidden"}});d3.selectAll("line.bigdayline").transition().duration(1000).attr("visibility",function(aN,aM){if(aN.importance>x){return"visbile"}else{return"hidden"}})});au.selectAll("line").data(ax.slice(0,ax.length-1)).enter().append("line").attr("stroke","grey").attr("stroke-width","2").attr("x1",function(aK,x){return d3.sum(Y.slice(0,x+1))+x*g+(x+1)*g+N}).attr("x2",function(aK,x){return d3.sum(Y.slice(0,x+1))+x*g+(x+1)*g+N}).attr("y1",0).attr("y2",19);var ah=ai.append("g").attr("id","context").attr("transform","translate("+at.left+","+(q+an)+")");var X,L;d3.csv("/static/hedonometer/data/word-vectors/sumhapps.csv",function(aK){X=aC(aK[0]);L=aC(aK[aK.length-1]);var aP=d3.time.format("%Y-%m-%d").parse;for(i=0;i<aK.length;i++){aK[i].shortDate=aK[i].date;aK[i].date=aP(aK[i].date);aK[i].value=+aK[i].value}timeseries=aK;F.domain(d3.extent(aK.map(function(aQ){return aQ.date})));y.domain([5.8,6.4]);f.domain(y.domain());var aO=aH.append("path").attr("id","path").data([aK]).attr("clip-path","url(#clip)").attr("d",k);aH.append("g").attr("class","x axis").attr("transform","translate(0,"+q+")").transition().duration(u).call(ag);aH.append("g").attr("class","y axis").attr("transform","translate("+am+",0)").call(yAxis2);horizontalLineGroup=aH.append("g");horizontalLineGroup.selectAll("line").data(y.ticks(7).slice(1,7)).enter().append("line").attr("class","horizontalLines").attr("x1",0).attr("x2",am).attr("y1",function(aQ){return y(aQ)}).attr("y2",function(aQ){return y(aQ)}).attr("fill","none").attr("stroke",function(aR,aQ){if(aQ===0){return"grey"}else{return"grey"}}).attr("stroke-dasharray",function(aR,aQ){if(aQ===0){return"5"}else{return"5"}}).attr("stroke-width","0.3px");horizontalLineGroup.append("line").attr("class","horizontalLinesFirst").attr("x1",0).attr("x2",am).attr("y1",function(aQ){return y(y.ticks(7)[0])}).attr("y2",function(aQ){return y(y.ticks(7)[0])}).attr("fill","none").attr("stroke",function(aR,aQ){if(aQ===0){return"grey"}else{return"grey"}}).attr("stroke-width","1.7px");var aN=aG.selectAll("circle").data(aK);var aM=(F.domain()[1].getTime()-F.domain()[0].getTime());aN.enter().append("circle").attr({"class":function(aQ){return weekDays[aQ.date.getDay()]},cx:function(aR,aQ){return F(aR.date)},"clip-path":"url(#clip)",shortdate:function(aQ){return aQ.shortDate},havg:function(aQ){aQ.value.toFixed(2)},day:function(aQ){return weekDays[aQ.date.getDay()]},date:function(aQ){return aQ.date},cy:function(aQ){return y(aQ.value)},r:function(aQ){return ac(aM)}}).on("mouseover.enlarge",function(){d3.select(this).transition().duration(250).attr("r",7.5).style("stroke-width",0.5)}).on("mouseover.popup",ao).on("mouseout",Q).on("mousedown",M);ah.append("path").data([aK]).attr("class","mini").attr("d",T);ah.append("g").attr("class","x axis").attr("transform","translate(0,"+ak+")").call(J);var aL=d3.time.format("%m-%d");d3.json("/api/v1/events/?format=json",function(aS){av=aS.objects;av.map(function(aW){aW.date=H.parse(aW.date);aW.x=parseFloat(aW.x);aW.shorter=aW.shorter.split(",");aW.y=d3.min([parseFloat(aW.y),q-parseFloat(y(aW.value))-aW.shorter.length*10]);aW.importance=parseFloat(aW.importance)});var aV=aG.selectAll("line.bigdayline").data(av).enter().append("line").attr({stroke:"grey","stroke-width":0.5,"class":"bigdayline",visibility:"hidden"});var aU=aG.selectAll("g.bigdaygroup").data(av).enter().append("g").attr("class","bigdaygroup").attr("transform",function(aX,aW){return"translate("+(F(aX.date)+aX.x)+","+(y(aX.value)+aX.y)+")"});var aR=6;var aT=3;var aQ=aU.append("text").text(function(aW){return aW.shorter[0]}).attr("class","bigdaytext").attr("dx",0).attr("dy",function(aW){return 0}).attr("stroke","").attr("fill","grey").attr("visibility","hidden");aU.append("text").text(function(aW){if(aW.shorter.length>1){return aW.shorter[1]}else{return""}}).attr("class","bigdaytext").attr("dx",0).attr("dy",function(aW){return 15}).attr("stroke","").attr("fill","grey").attr("visibility","hidden");aU.append("text").text(function(aW){if(aW.shorter.length>2){return aW.shorter[2]}else{return""}}).attr("class","bigdaytext").attr("dx",0).attr("dy",function(aW){return 30}).attr("stroke","").attr("fill","grey").attr("visibility","hidden");aU.append("text").text(function(aW){if(aW.shorter.length>3){return aW.shorter[3]}else{return""}}).attr("class","bigdaytext").attr("dx",0).attr("dy",function(aW){return 45}).attr("stroke","").attr("fill","grey").attr("visibility","hidden");aF();aH.selectAll(".brushingline").attr({visibility:"hidden"});d3.selectAll("text.bigdaytext").attr("dx",function(aX,aW){return -this.clientWidth/2})});var x=ah.append("g").attr("class","x brush").call(aa);x.selectAll("rect").attr("y",-6).attr("height",ak+7);aF();aH.selectAll(".brushingline").attr({visibility:"hidden"})});function k(x){return w(x.map(function(aK){return[aK.x,aK.y]}))}function K(){aj.varval(S(F.domain()[0]));toencoder.varval(S(F.domain()[1]));aH.selectAll(".brushingline").attr({visibility:"hidden"})}aH.selectAll("brushingline").data([0,am]).enter().append("line").attr({"class":"brushingline",x1:function(aK,x){return aK},x2:function(aK,x){return t(aa.extent()[x])},y1:475,y2:500,stroke:"#C0C0C0","stroke-width":2,visibility:"hidden"});function aF(){var aO=(aa.extent()[1].getTime()-aa.extent()[0].getTime());F.domain(aa.empty()?t.domain():aa.extent());aH.select("#path").attr("d",k);aH.select(".x.axis").call(ag);aH.selectAll(".brushingline").attr({x2:function(aQ,aP){return t(aa.extent()[aP])},visibility:"visible"});var aN=aG.selectAll("circle").attr("cx",function(aP){return F(aP.date)}).attr("cy",function(aP){return y(aP.value)}).attr("r",function(aP){return ac(aO)});var aM=aG.selectAll("rect").attr("x",function(aP){return F(aP.date)}).attr("y",function(aP){return y(aP.value+0.02)});var aK=aG.selectAll("line.bigdayline").attr({x1:function(aQ,aP){return F(aQ.date)},x2:function(aQ,aP){return F(aQ.date)+aQ.x},y1:function(aQ,aP){return y(aQ.value)+3*(aQ.y/Math.abs(aQ.y))},y2:function(aQ,aP){if(aQ.y>0){return y(aQ.value)+aQ.y-10}else{return y(aQ.value)+aQ.y+aQ.shorter.length*12-6}}});var x=aG.selectAll("g.bigdaygroup").attr("transform",function(aQ,aP){return"translate("+(F(aQ.date)+aQ.x)+","+(y(aQ.value)+aQ.y)+")"});d3.select("#minilist").remove();var aL=V(aO);d3.selectAll("text.bigdaytext").transition().duration(1000).attr("visibility",function(aQ,aP){if(aQ.importance>aL){return"visible"}else{return"hidden"}});d3.selectAll("line.bigdayline").transition().duration(1000).attr("visibility",function(aQ,aP){if(aQ.importance>aL){return"visbile"}else{return"hidden"}})}var B=(U.getTime()-1222964002773);var ac=d3.scale.linear().range([m,1.25]);ac.domain([0,B]);function h(aK,aM,aL){if(aK>=600){aK=aK-220;if(aM<=210){aM=aM-10;aK=aK-30}else{aM=aM-224}}else{aK=aK-7;if(aM<=210){aM=aM-10;aK=aK+20}else{aM=aM-224}}if(aL=="X"){return aK}if(aL=="Y"){return aM}}function ad(aL,aQ){var aP=["10 0, 10 225, 20 215, 230 215, 230 0, 10 0"];var aO=["205 215, 215 225, 215 215, 230 215, 230 0, 10 0, 10 215, 205 215"];var aN=["10 10, 0 20, 10 20, 10 215, 230 215, 230 0, 10 0, 10 10"];var aM=["230 10, 240 20, 230 20, 230 215, 10 215, 10 0, 230 0, 230 10"];var aK=[];if(aL>=600){if(aQ<=210){aK=aM}else{aK=aO}}else{if(aQ<=210){aK=aN}else{aK=aP}}return aK}function r(x){d3.select("#moveshifthere").selectAll("svg").remove();d3.select("#minilist").remove();var aL=558;var aK=495;d3.text("static/hedonometer/data/word-vectors/"+S(x)+"-sum.csv",function(aM){compFvec=aM.split("\n").slice(0,10222);d3.text("static/hedonometer/data/word-vectors/"+S(d3.time.day.offset(x,0))+"-prev7.csv",function(bm){refFvec=bm.split("\n").slice(0,10222);for(var bk=0;bk<words.length;bk++){var aU=false;for(var bi=0;bi<ap.length;bi++){if(ap[bi]==words[bk]){aU=true}}if(lens[bk]>4&&lens[bk]<6){aU=true}if(aU){refFvec[bk]=0;compFvec[bk]=0}}shiftObj=shift(refFvec,compFvec,lens,words);var a9=shiftObj.sortedMag.slice(0,1000),bp=shiftObj.sortedType.slice(0,1000),a5=shiftObj.sortedWords.slice(0,1000),aP=shiftObj.sumTypes.slice(0,1000),bj=shiftObj.refH,aX=shiftObj.compH;dateencoder.varval(S(x));var a6=false;var bq="";addthis_share.passthrough.twitter.text=D(x)+", word shift:";for(var bk=0;bk<av.length;bk++){if(av[bk].date.getTime()===x.getTime()){a6=true;bq=av[bk].wiki;addthis_share.passthrough.twitter.text=av[bk].longer+", "+D(x)+", word shift:";break}}if(a6){d3.select("#modaltitle").html("Interactive Wordshift <span class='label label-default'>Major Event <i class='fa fa-signal'></i></span> <a href='"+bq+"' target='_blank'><img src='https://lh6.ggpht.com/-Eq7SGa8CVtZCQPXmnux59sebPPU04j1gak4ppkMVboUMQ_ucceGCHrC1wtqfqyByg=w300' height='35'/></a>")}else{d3.select("#modaltitle").html("Interactive Wordshift <span class='label label-default'></span><img src='static/hedonometer/graphics/white.png' height='35'/>")}var a1=d3.select("#moveshifthere");var a0=d3.select("#moveshiftherefooter");a1.selectAll("p").remove();a1.append("p").attr("class","shifttitle").html(function(bs,br){return"<b>"+d(x)+"</b>"});if(a6){for(var bk=0;bk<av.length;bk++){if(av[bk].date.getTime()===x.getTime()){a1.append("p","svg").attr("class","shifttitle pullright").html(function(){return"<b>"+av[bk].longer+"</b>"});break}}}else{a1.append("p","svg").attr("class","shifttitle pullright").html(function(){return"<br>"})}a1.append("p").attr("class","shifttitle").text(function(bs,br){return"Average happiness: "+parseFloat(aX).toFixed(3)});a1.append("p").text(function(){var br="What's making this day ";return bj<=aX?br+"happier than the last seven days:":br+"sadder than the last seven days:"});if(x.getTime()===timeseries[0].date.getTime()){a0.select(".left").attr("disabled","disabled")}else{a0.select(".left").attr("disabled",null)}if(x.getTime()===timeseries[timeseries.length-1].date.getTime()){a0.select(".right").attr("disabled","disabled")}else{a0.select(".right").attr("disabled",null)}var a3=d3.select("#moveshifthere").append("svg").attr("height",aK).attr("width",aL).attr("id","modalsvg");a3.append("svg").attr("id","shiftcanvas").attr("width",function(){return aL-20-10}).attr("height",function(){return aK-25});a3.append("text").text("Per word average happiness shift").attr("class","axes-text").attr("x",(aL-20-10)/2+20).attr("y",aK-7).attr("font-size","18.0px").attr("fill","#000000").attr("style","text-anchor: middle;");var aT=a3.select("svg"),bl=(aL-20-10),be=(aK-40-25),bb=false;var aQ={top:0,right:0,bottom:0,left:0},a2=bl-aQ.left-aQ.right,bo=be-aQ.top-aQ.bottom,aS=11;var bg=(7+17*3+14+5-13),ba=100-20-13,aR=(7+17*3+15-13),aN=(a2-20),aO=(bo-20);var bn=aN/2;a5=a5.map(function(bs,br){if(bp[br]==0){return bs.concat("-\u2193")}else{if(bp[br]==1){return"\u2193+".concat(bs)}else{if(bp[br]==2){return"\u2191-".concat(bs)}else{return bs.concat("+\u2191")}}}});var a4=d3.max(a5.slice(0,5).map(function(br){return br.width()}));var aW=d3.scale.linear().domain([-Math.abs(a9[0]),Math.abs(a9[0])]).range([a4+10,aN-a4-10]);var aV=d3.scale.linear().domain([R+1,1]).range([aO+2,bg]);var bh=d3.behavior.zoom().y(aV).scaleExtent([1,1]).on("zoom",a7);var bc=aT.append("g").attr("transform","translate(20,0)").attr("width",aN).attr("height",aO).attr("class","main").call(bh);bc.append("rect").attr("width",aN).attr("height",aO+60).attr("class","bg").style({"stroke-width":"3",stroke:"rgb(0,0,0)"}).attr("fill","#FCFCFC").attr("opacity","0.96");aT.append("text").text("Word Rank").attr("class","axes-text").attr("x",15).attr("y",bo/2+60).attr("font-size","18.0px").attr("fill","#000000").attr("transform","rotate(-90.0,"+(15)+","+(bo/2+60)+")");var aY=13;bc.selectAll("rect.shiftrect").data(a9).enter().append("rect").attr("fill",function(bs,br){if(bp[br]==2){return"#4C4CFF"}else{if(bp[br]==3){return"#FFFF4C"}else{if(bp[br]==0){return"#B3B3FF"}else{return"#FFFFB3"}}}}).attr("class",function(bs,br){return"shiftrect "+intStr[bp[br]]}).attr("x",function(bs,br){if(bs>0){return bn}else{return aW(bs)}}).attr("y",function(bs,br){return aV(br+1)}).attr("height",function(bs,br){return aS}).attr("width",function(bs,br){if((bs)>0){return aW(bs)-aW(0)}else{return aW(0)-aW(bs)}}).style({opacity:"0.7","stroke-width":"1",stroke:"rgb(0,0,0)"});bc.selectAll("text.shifttext").data(a9).enter().append("text").attr("class",function(bs,br){return"shifttext "+intStr[bp[br]]}).attr("x",function(bs,br){if(bs>0){return aW(bs)+2}else{return aW(bs)-2}}).attr("y",function(bs,br){return aV(br+1)+aS}).style({"text-anchor":function(bs,br){if(a9[br]<0){return"end"}else{return"start"}},"font-size":aY}).text(function(bs,br){return a5[br]});if(shiftseldecoder().current==="posup"){bb=true;bf();bc.selectAll("rect.shiftrect.zero").attr("y",function(bs,br){return aV(br+1)}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.zero").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.one").attr("y",function(bs,br){return aV(br+1)}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.one").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.two").attr("y",function(bs,br){return aV(br+1)}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.two").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.three").attr("y",function(bs,br){return aV(br+1)}).attr("transform","translate(0,0)");bc.selectAll("text.shifttext.three").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform","translate(0,0)")}else{if(shiftseldecoder().current==="negdown"){bb=true;bf();bc.selectAll("rect.shiftrect.zero").attr("y",function(bs,br){return aV(br+1)}).attr("transform","translate(0,0)");bc.selectAll("text.shifttext.zero").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform","translate(0,0)");bc.selectAll("rect.shiftrect.one").attr("y",function(bs,br){return aV(br+1)}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.one").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.two").attr("y",function(bs,br){return aV(br+1)}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.two").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.three").attr("y",function(bs,br){return aV(br+1)}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.three").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}})}else{if(shiftseldecoder().current==="posdown"){bb=true;bf();bc.selectAll("rect.shiftrect.zero").attr("y",function(bs,br){return aV(br+1)}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.zero").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.three").attr("y",function(bs,br){return aV(br+1)}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.three").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.two").attr("y",function(bs,br){return aV(br+1)}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.two").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.one").attr("y",function(bs,br){return aV(br+1)}).attr("transform","translate(0,0)");bc.selectAll("text.shifttext.one").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform","translate(0,0)")}else{if(shiftseldecoder().current==="negup"){bb=true;bf();bc.selectAll("rect.shiftrect.zero").attr("y",function(bs,br){return aV(br+1)}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.zero").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.one").attr("y",function(bs,br){return aV(br+1)}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.one").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.two").attr("y",function(bs,br){return aV(br+1)}).attr("transform","translate(0,0)");bc.selectAll("text.shifttext.two").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform","translate(0,0)");bc.selectAll("rect.shiftrect.three").attr("y",function(bs,br){return aV(br+1)}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.three").attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform",function(bs,br){if(bs<0){return"translate(-500,0)"}else{return"translate(500,0)"}})}}}}bc.append("rect").attr("x",3).attr("y",3).attr("width",aN-6).attr("height",73-13).attr("fill","white").style({opacity:"1.0"});bc.append("line").attr("x1",0).attr("x2",aN).attr("y1",aR).attr("y2",aR).style({"stroke-width":"1",stroke:"black"});var a8=Math.max(Math.abs(aP[1]),Math.abs(aP[2]),aP[0],aP[3]);topScale=d3.scale.linear().domain([-a8,a8]).range([aN*0.12,aN*0.88]);var aZ=[aP[3],aP[0],d3.sum(aP)];bc.selectAll(".sumrectR").data(aZ).enter().append("rect").attr("fill",function(bs,br){if(br==0){return"#FFFF4C"}else{if(br==1){return"#B3B3FF"}else{return"#272727"}}}).attr("class","sumrectR").attr("x",function(bs,br){if(bs>0){return bn}else{return topScale(bs)}}).attr("y",function(bs,br){if(br<3){return br*17+7}else{return br*17+7-2}}).style({opacity:"0.7","stroke-width":"1",stroke:"rgb(0,0,0)"}).attr("height",function(bs,br){return 14}).attr("width",function(bs,br){if(bs>0){return topScale(bs)-bn}else{return bn-topScale(bs)}}).on("mouseover",function(bs){var br=d3.select(this).style({opacity:"1.0"})}).on("mouseout",function(bs){var br=d3.select(this).style({opacity:"0.7"})}).on("click",function(bs,br){if(br==0){bb=true;bf();shiftselencoder.varval("posup");bc.selectAll("rect.shiftrect.zero").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.zero").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.one").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.one").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.two").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.two").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.three").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform","translate(0,0)");bc.selectAll("text.shifttext.three").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform","translate(0,0)")}else{if(br==1){bb=true;bf();shiftselencoder.varval("negdown");bc.selectAll("rect.shiftrect.zero").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform","translate(0,0)");bc.selectAll("text.shifttext.zero").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform","translate(0,0)");bc.selectAll("rect.shiftrect.one").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.one").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.two").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.two").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.three").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.three").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}})}else{if(br==2){bd()}}}});bc.selectAll(".sumtextR").data([aP[3],aP[0],d3.sum(aP)]).enter().append("text").attr("class","sumtextR").style("text-anchor",function(bs,br){if(bs>0){return"start"}else{return"end"}}).attr("y",function(bs,br){return br*17+17}).text(function(bs,br){if(br==0){return"\u2211+\u2191"}if(br==1){return"\u2211-\u2193"}else{return"\u2211"}}).attr("x",function(bs,br){return topScale(bs)+5*bs/Math.abs(bs)});var aZ=[aP[2],aP[1]];bc.selectAll(".sumrectL").data(aZ).enter().append("rect").attr("fill",function(bs,br){if(br==0){return"#FFFFB3"}else{if(br==1){return"#4C4CFF"}else{if(bs>0){return"#B3B3FF"}else{return"#4C4CFF"}}}}).attr("class","sumrectL").attr("x",function(bs,br){if(br<2){return topScale(bs)}else{if((aP[3]+aP[1])*(aP[0]+aP[2])>0){if(bs>0){return topScale((aP[3]+aP[1]))}else{return topScale(bs)-(bn-topScale((aP[3]+aP[1])))}}else{if(bs>0){return bn}else{return topScale(bs)}}}}).attr("y",function(bs,br){return br*17+7}).style({opacity:"0.7","stroke-width":"1",stroke:"rgb(0,0,0)"}).attr("height",function(bs,br){return 14}).attr("width",function(bs,br){if(bs>0){return topScale(bs)-bn}else{return bn-topScale(bs)}}).on("mouseover",function(bs){var br=d3.select(this).style({opacity:"1.0"})}).on("mouseout",function(bs){var br=d3.select(this).style({opacity:"0.7"})}).on("click",function(bs,br){bb=true;bf();if(br==0){shiftselencoder.varval("posdown");bc.selectAll("rect.shiftrect.zero").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.zero").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.three").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.three").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.two").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.two").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.one").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform","translate(0,0)");bc.selectAll("text.shifttext.one").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform","translate(0,0)")}else{if(br==1){shiftselencoder.varval("negup");bc.selectAll("rect.shiftrect.zero").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.zero").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.one").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.one").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("rect.shiftrect.two").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform","translate(0,0)");bc.selectAll("text.shifttext.two").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform","translate(0,0)");bc.selectAll("rect.shiftrect.three").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bc.selectAll("text.shifttext.three").transition().duration(1000).attr("y",function(bu,bt){return aV(bt+1)+aS}).attr("transform",function(bu,bt){if(bu<0){return"translate(-500,0)"}else{return"translate(500,0)"}})}}});bc.selectAll(".sumtextL").data([aP[2],aP[1]]).enter().append("text").attr("class","sumtextL").style("text-anchor","end").attr("y",function(bs,br){return br*17+17}).text(function(bs,br){if(br==0){return"\u2211+\u2193"}else{return"\u2211-\u2191"}}).attr("x",function(bs,br){return topScale(bs)-5});function a7(){if(bb){for(var br=0;br<4;br++){bc.selectAll("rect.shiftrect."+intStr[br]).attr("y",function(bt,bs){return aV(bs+1)});bc.selectAll("text.shifttext."+intStr[br]).attr("y",function(bt,bs){return aV(bs+1)+aS})}}else{bc.selectAll("rect.shiftrect").attr("y",function(bt,bs){return aV(bs+1)});bc.selectAll("text.shifttext").attr("y",function(bt,bs){return aV(bs+1)+aS})}}function bd(){bb=false;d3.selectAll("rect.shiftrect").transition().duration(1000).attr("y",function(bs,br){return aV(br+1)}).attr("transform","translate(0,0)");d3.selectAll("text.shifttext").transition().duration(1000).attr("y",function(bs,br){return aV(br+1)+aS}).attr("transform","translate(0,0)");shiftselencoder.varval("none");shiftselencoder.destroy()}function bf(){d3.selectAll(".resetbutton").remove();var bs=d3.select("#modalsvg");var br=bs.append("g").attr("transform","translate("+(0)+","+(56)+") rotate(-90)").attr("class","resetbutton");br.append("rect").attr("x",0).attr("y",0).attr("rx",3).attr("ry",3).attr("width",48).attr("height",17).attr("fill","#F0F0F0").style({"stroke-width":"0.5",stroke:"rgb(0,0,0)"});br.append("text").text("Reset").attr("x",6).attr("y",13).attr("font-size","13.0px");br.append("rect").attr("x",0).attr("y",0).attr("rx",3).attr("ry",3).attr("width",48).attr("height",189).attr("fill","white").style({opacity:"0.0"}).on("click",function(){bd()})}bf();$("#myModal").modal("toggle")})});$("#dp1").datepicker("setDate",x)}var R=27;function e(aM,aL,aK){d3.select("#minilist").remove();var aR=parseFloat(aM);var aQ=parseFloat(aL);var x=h(aR,aQ,"X");var aV=h(aR,aQ,"Y");var aS=5;var aT=210;var aP=9;var aU=d3.select("#timeseries").append("g").attr("transform","translate("+x+","+aV+")").attr("id","minilist").on("mouseleave",function(aX,aW){minilistMouseLeaveTimer=setTimeout(function(){d3.select("#minilistbg").transition().duration(200).remove();d3.select("#minilist").transition().duration(200).remove()},popupExitDur)}).on("mouseenter",function(aY,aW){try{clearTimeout(minilistMouseLeaveTimer)}catch(aX){}});aU.append("rect").attr("id","minilistbg").attr("width",315).attr("height",260).attr("transform","translate(-40,-40)").attr("fill","grey").attr("opacity",0.01);aU.append("svg:polyline").attr("id","shadow").attr("points",function(aW){return ad(aR,aQ)}).attr("transform","translate(4,4)").attr("stroke","grey").attr("fill","grey").attr("opacity",0.2).attr("stroke-width","1");aU.append("svg:polyline").attr("id","bg").attr("points",function(aW){return ad(aR,aQ)}).attr("stroke","grey").attr("fill","white").attr("opacity",0.96).attr("stroke-width","1");aU.append("svg:text").attr("x",20).attr("y",14).text(d(aK)).attr("font-size","10px").attr("font-weight","bold").attr("class","shifttitledate");for(var aO=0;aO<av.length;aO++){if(av[aO].date.getTime()===aK.getTime()){aU.append("text").attr("x",200).attr("y",24).attr("font-family","FontAwesome").attr("font-size",function(aW){return"2em"}).text(function(){return"\uF012"});var aN=aD(av[aO].longer,230);aU.append("text").attr("x",20).attr("y",38).text(function(){return aN[0]}).attr("font-weight","bold").attr("font-size","10px").attr("class","shifttitlebigdaytext");if(aN.length>1){aU.append("text").attr("x",20).attr("y",49).text(function(){return aN[1]}).attr("font-weight","bold").attr("font-size","10px").attr("class","shifttitlebigdaytext")}break}}d3.csv("/static/hedonometer/data/shifts/"+S(aK)+"-shift.csv",function(aW){var aZ=aW.map(function(a0){return a0.word});var aY=aW.map(function(a0){return a0.mag});var aX=aW.map(function(a0){return a0.type});d3.csv("/static/hedonometer/data/shifts/"+S(aK)+"-metashift.csv",function(a1){var a2=a1.map(function(a8){return a8.refH});var a3=a1.map(function(a8){return a8.compH});aU.append("svg:text").attr("x",20).attr("y",25).text("Average Happiness: "+parseFloat(a3).toFixed(2)).attr("font-size","10px").attr("class","shifttitlehavg");aU.append("svg:text").attr("x",20).attr("y",62).attr("font-size","10px").text(function(){var a8="What's making this day ";return a2<=a3?a8+"happier":a8+"sadder"}).attr("class","shifttitlewhatisone");aU.append("svg:text").attr("x",20).attr("y",72).attr("font-size","10px").text(function(){return"than the last seven days:"}).attr("class","shifttitlewhatistwo");aU.append("line").attr("x1",20).attr("x2",220).attr("y1",76).attr("y2",76).attr("stroke","grey").attr("stroke-width",".3px").attr("class","shiftsepline");aU.append("line").attr("x1",20).attr("x2",220).attr("y1",198).attr("y2",198).attr("stroke","grey").attr("stroke-width",".3px").attr("class","shiftsepline");aU.append("g").attr("transform","translate(40,211)").append("text").text("Click for interactive word shift.").attr("class","expanderbutton").on("click",function(){r(aK)});var a7=aU.append("svg:g").attr("transform","translate(20,79)").attr("id","smallshiftgroup");var a6=190,a5=115,a0=10;var a4=a7.append("svg").attr("width",a6).attr("height",a5).attr("id","shiftcanvas");summaryStats=false;ar(a4,a6,a5,a0,aY,aX,aZ);aU.append("rect").attr({x:0,y:0,width:220,height:200,fill:"white",opacity:0.01}).on("click",function(){r(aK)})})})}function ar(aM,aL,aR,aY,aP,a5,a3){var aV={top:0,right:0,bottom:0,left:0},aS=aL-aV.left-aV.right,a6=aR-aV.top-aV.bottom,aU=9;var a0=1,aN=0,a1=0,aZ=0.99*aS,aX=0.99*a6;var aO=aZ/2;a3=a3.map(function(a7,x){if(a5[x]==0){return a7.concat("-\u2193")}else{if(a5[x]==1){return"\u2193+".concat(a7)}else{if(a5[x]==2){return"\u2191-".concat(a7)}else{return a7.concat("+\u2191")}}}});var a4=d3.max(a3.slice(0,5).map(function(x){return x.width()}));var aT=d3.scale.linear().domain([-Math.abs(aP[0]),Math.abs(aP[0])]).range([a4-5,aL-a4+5]);var aQ=d3.scale.linear().domain([aY+1,1]).range([aX+2,a0]);var aK=d3.behavior.zoom().y(aQ).scaleExtent([1,1]).on("zoom",aW);var a2=aM.append("g").attr("width",aZ).attr("height",aX).attr("class","main").call(aK);a2.append("svg:rect").attr("width",aZ).attr("height",aX).attr("class","bg").attr("fill","#FCFCFC").attr("opacity","0.96");intStr=["zero","one","two","three"];a2.selectAll("rect.shiftrect").data(aP).enter().append("rect").attr("fill",function(a7,x){if(a5[x]==2){return"#4C4CFF"}else{if(a5[x]==3){return"#FFFF4C"}else{if(a5[x]==0){return"#B3B3FF"}else{return"#FFFFB3"}}}}).attr("class",function(a7,x){return"shiftrect "+intStr[a5[x]]}).attr("x",function(a7,x){if(a7>0){return aO}else{return aT(a7)}}).attr("y",function(a7,x){return aQ(x+1)}).style({opacity:"0.7","stroke-width":"1",stroke:"rgb(0,0,0)"}).attr("height",function(a7,x){return aU}).attr("width",function(a7,x){if((a7)>0){return aT(a7)-aT(0)}else{return aT(0)-aT(a7)}}).on("mouseover",function(x){}).on("mouseout",function(a7){var x=d3.select(this).style({opacity:"0.7"})});a2.selectAll("text.shifttext").data(aP).enter().append("text").attr("class",function(a7,x){return"shifttext "+intStr[a5[x]]}).style({"text-anchor":function(a7,x){if(aP[x]<0){return"end"}else{return"start"}},"font-size":11}).attr("y",function(a7,x){return aQ(x+1)+aU}).text(function(a7,x){return a3[x]}).attr("x",function(a7,x){if(a7>0){return aT(a7)+2}else{return aT(a7)-2}});function aW(){a2.selectAll("rect.shiftrect").attr("y",function(a7,x){return aQ(x+1)});a2.selectAll("text.shifttext").attr("y",function(a7,x){return aQ(x+1)+aU})}}b=function b(aQ){var aP=this;var aO=d3.select("#moveshifthere");var aN=aQ;dateencoder.varval(S(aN));addthis_share.passthrough.twitter.text=D(aN)+", word shift:";var x=false;var aM="";for(var aL=0;aL<av.length;aL++){if(av[aL].date.getTime()===aN.getTime()){x=true;aM=av[aL].wiki;addthis_share.passthrough.twitter.text=av[aL].longer+", "+D(popdate)+", word shift:";break}}if(x){d3.select("#modaltitle").html("Interactive Wordshift <span class='label label-default'>Major Event <i class='fa fa-signal'></i></span> <a href='"+aM+"' target='_blank'><img src='https://lh6.ggpht.com/-Eq7SGa8CVtZCQPXmnux59sebPPU04j1gak4ppkMVboUMQ_ucceGCHrC1wtqfqyByg=w300' height='35'/></a>")}else{d3.select("#modaltitle").html("Interactive Wordshift <span class='label label-default'></span><img src='static/hedonometer/graphics/white.png' height='35'/>")}var aK=d3.select("#moveshiftherefooter");if(aN.getTime()===timeseries[0].date.getTime()){aK.select(".left").attr("disabled","disabled")}else{aK.select(".left").attr("disabled",null)}if(aN.getTime()===timeseries[timeseries.length-1].date.getTime()){aK.select(".right").attr("disabled","disabled")}else{aK.select(".right").attr("disabled",null)}d3.text("static/hedonometer/data/word-vectors/"+S(aN)+"-sum.csv",function(aR){compFvec=aR.split("\n").slice(0,10222);d3.text("static/hedonometer/data/word-vectors/"+S(d3.time.day.offset(aN,0))+"-prev7.csv",function(bo){refFvec=bo.split("\n").slice(0,10222);for(var bm=0;bm<words.length;bm++){var a1=false;for(var bk=0;bk<ap.length;bk++){if(ap[bk]==words[bm]){a1=true}}if(lens[bm]>4&&lens[bm]<6){a1=true}if(a1){refFvec[bm]=0;compFvec[bm]=0}}shiftObj=shift(refFvec,compFvec,lens,words);var a7=shiftObj.sortedMag.slice(0,1000),bh=shiftObj.sortedType.slice(0,1000),bp=shiftObj.sortedWords.slice(0,1000),aU=shiftObj.sumTypes.slice(0,1000),bl=shiftObj.refH,a5=shiftObj.compH;var bf=558;var a0=495;var bn=bf-20-10;var bi=a0-40-25;var bg=aO.select("#shiftcanvas");var aW={top:0,right:0,bottom:0,left:0},ba=bn-aW.left-aW.right,br=bi-aW.top-aW.bottom,aZ=11;var bj=(7+17*3+14+5),bd=100,aY=(7+17*3+15),aS=(ba-20),aT=(br-20);var bq=aS/2;var a4=d3.scale.linear().domain([-Math.abs(a7[0]),Math.abs(a7[0])]).range([(bp[0].length+4.5)*5,aS-(bp[0].length+4.5)*5]);var a3=d3.scale.linear().domain([R+1,1]).range([aT+2,bj]);var a9=bg.selectAll("rect.shiftrect").data(a7);var a2=bg.selectAll("text.shifttext").data(a7);if(shiftseldecoder().current==="none"||shiftseldecoder().current.length===0){a9.transition().attr("fill",function(bt,bs){if(bh[bs]==2){return"#4C4CFF"}else{if(bh[bs]==3){return"#FFFF4C"}else{if(bh[bs]==0){return"#B3B3FF"}else{return"#FFFFB3"}}}}).attr("class",function(bt,bs){return"shiftrect "+intStr[bh[bs]]}).attr("x",function(bt,bs){if(bt>0){return bq}else{return a4(bt)}}).attr("height",function(bt,bs){return aZ}).attr("width",function(bt,bs){if((bt)>0){return a4(bt)-a4(0)}else{return a4(0)-a4(bt)}});a2.transition().attr("class",function(bt,bs){return"shifttext "+intStr[bh[bs]]}).style({"text-anchor":function(bt,bs){if(a7[bs]<0){return"end"}else{return"start"}},"font-size":11}).text(function(bt,bs){if(bh[bs]==0){tmpStr="-\u2193"}else{if(bh[bs]==1){tmpStr="\u2193+"}else{if(bh[bs]==2){tmpStr="\u2191-"}else{tmpStr="+\u2191"}}}if(a7[bs]<0){return tmpStr.concat(bp[bs])}else{return bp[bs].concat(tmpStr)}}).attr("x",function(bt,bs){if(bt>0){return a4(bt)+2}else{return a4(bt)-2}})}else{a9.attr("fill",function(bt,bs){if(bh[bs]==2){return"#4C4CFF"}else{if(bh[bs]==3){return"#FFFF4C"}else{if(bh[bs]==0){return"#B3B3FF"}else{return"#FFFFB3"}}}}).attr("class",function(bt,bs){return"shiftrect "+intStr[bh[bs]]}).attr("x",function(bt,bs){if(bt>0){return bq}else{return a4(bt)}}).attr("height",function(bt,bs){return aZ}).attr("width",function(bt,bs){if((bt)>0){return a4(bt)-a4(0)}else{return a4(0)-a4(bt)}});a2.attr("class",function(bt,bs){return"shifttext "+intStr[bh[bs]]}).style({"text-anchor":function(bt,bs){if(a7[bs]<0){return"end"}else{return"start"}},"font-size":11}).text(function(bt,bs){if(bh[bs]==0){tmpStr="-\u2193"}else{if(bh[bs]==1){tmpStr="\u2193+"}else{if(bh[bs]==2){tmpStr="\u2191-"}else{tmpStr="+\u2191"}}}if(a7[bs]<0){return tmpStr.concat(bp[bs])}else{return bp[bs].concat(tmpStr)}}).attr("x",function(bt,bs){if(bt>0){return a4(bt)+2}else{return a4(bt)-2}});if(shiftseldecoder().current==="posup"){bg.selectAll("rect.shiftrect.zero").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("text.shifttext.zero").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("rect.shiftrect.one").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("text.shifttext.one").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("rect.shiftrect.two").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("text.shifttext.two").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("rect.shiftrect.three").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform","translate(0,0)");bg.selectAll("text.shifttext.three").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform","translate(0,0)")}else{if(shiftseldecoder().current==="negdown"){bg.selectAll("rect.shiftrect.zero").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform","translate(0,0)");bg.selectAll("text.shifttext.zero").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform","translate(0,0)");bg.selectAll("rect.shiftrect.one").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("text.shifttext.one").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("rect.shiftrect.two").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("text.shifttext.two").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("rect.shiftrect.three").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("text.shifttext.three").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}})}else{if(shiftseldecoder().current==="posdown"){bg.selectAll("rect.shiftrect.zero").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("text.shifttext.zero").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("rect.shiftrect.three").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("text.shifttext.three").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("rect.shiftrect.two").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("text.shifttext.two").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("rect.shiftrect.one").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform","translate(0,0)");bg.selectAll("text.shifttext.one").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform","translate(0,0)")}else{if(shiftseldecoder().current==="negup"){bg.selectAll("rect.shiftrect.zero").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("text.shifttext.zero").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("rect.shiftrect.one").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("text.shifttext.one").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("rect.shiftrect.two").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform","translate(0,0)");bg.selectAll("text.shifttext.two").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform","translate(0,0)");bg.selectAll("rect.shiftrect.three").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}});bg.selectAll("text.shifttext.three").transition().duration(1000).attr("y",function(bt,bs){return a3(bs+1)+aZ}).attr("transform",function(bt,bs){if(bt<0){return"translate(-500,0)"}else{return"translate(500,0)"}})}}}}}var a8=d3.select("#moveshifthere");a8.selectAll("p").remove();a8.insert("p","svg").attr("class","shifttitle pullleft").html(function(bt,bs){return"<b>"+d(aN)+"</b>"});if(x){for(var bm=0;bm<av.length;bm++){if(av[bm].date.getTime()===aN.getTime()){a8.insert("p","svg").attr("class","shifttitle pullright").html(function(){return"<b>"+av[bm].longer+"</b>"});break}}}else{a8.insert("p","svg").attr("class","shifttitle pullright").html(function(){return"<br>"})}a8.insert("p","svg").attr("class","shifttitle").text(function(bt,bs){return"Average Happiness: "+parseFloat(a5).toFixed(3)});a8.insert("p","svg").text(function(){var bs="What's making this day ";return bl<=a5?bs+"happier than the last seven days:":bs+"sadder than the last seven days:"});var bb=Math.max(Math.abs(aU[1]),Math.abs(aU[2]),aU[0],aU[3]);topScale=d3.scale.linear().domain([-bb,bb]).range([aS*0.1,aS*0.9]);var a6=[aU[3],aU[0],d3.sum(aU)];var be=bg.selectAll(".sumrectR").data(a6);be.transition().attr("x",function(bt,bs){if(bt>0){return bq}else{return topScale(bt)}}).attr("width",function(bt,bs){if(bt>0){return topScale(bt)-bq}else{return bq-topScale(bt)}});var bc=bg.selectAll(".sumtextR").data([aU[3],aU[0],d3.sum(aU)]);bc.transition().attr("class","sumtextR").style("text-anchor",function(bt,bs){if(bt>0){return"start"}else{return"end"}}).attr("x",function(bt,bs){return topScale(bt)+5*bt/Math.abs(bt)});var a6=[aU[1],aU[2],aU[0]+aU[2]];var aX=bg.selectAll(".sumrectL").data(a6);aX.transition().attr("fill",function(bt,bs){if(bs==0){return"#FFFFB3"}else{if(bs==1){return"#4C4CFF"}else{if(bt>0){return"#B3B3FF"}else{return"#4C4CFF"}}}}).attr("x",function(bt,bs){if(bs<2){return topScale(bt)}else{if((aU[3]+aU[1])*(aU[0]+aU[2])>0){if(bt>0){return topScale((aU[3]+aU[1]))}else{return topScale(bt)-(bq-topScale((aU[3]+aU[1])))}}else{if(bt>0){return bq}else{return topScale(bt)}}}}).attr("width",function(bt,bs){if(bt>0){return topScale(bt)-bq}else{return bq-topScale(bt)}});var aV=bg.selectAll(".sumtextL").data([aU[1],aU[2]]);aV.transition().attr("x",function(bt,bs){return topScale(bt)-5})})})};$("#myModal").on("hidden.bs.modal",function(x){dateencoder.varval("none");dateencoder.destroy();shiftselencoder.varval("none");shiftselencoder.destroy()});$("#dp1").datepicker({autoclose:true,format:"yyyy-mm-dd",orientation:"top-left",language:"en",startDate:X,endDate:L}).on("changeDate",function(x){b(x.date)});if(datedecoder().current!=="none"&&datedecoder().current.length>0){var j=S.parse(datedecoder().current);r(j)}aA=function aA(aK,aL){var x=new Date(aK);x.setDate(aK.getDate()+aL);return x};console.log("enjoy :)")})();